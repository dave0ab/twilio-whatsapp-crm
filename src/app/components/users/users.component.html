<div class="p-6 fade-in">
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-2xl font-title font-semibold text-gray-900 mb-2">Users</h1>
      <p class="text-gray-600">Manage registered users and their roles</p>
    </div>
    <button 
      (click)="showAddUserForm = true"
      class="bg-gradient-imarlet hover:shadow-imarlet text-white px-4 py-2 rounded-xl font-medium transition-all duration-200 btn-hover"
    >
      <span class="material-icons mr-2 text-sm">person_add</span>
      Add User
    </button>
  </div>

  <!-- Search and Filter -->
  <div class="bg-white rounded-xl shadow-soft p-6 mb-6 interactive-hover">
    <div class="flex flex-col sm:flex-row gap-4">
      <div class="flex-1">
        <input 
          type="text" 
          placeholder="Search users..."
          [(ngModel)]="searchTerm"
          (input)="filterUsers()"
          class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-200"
        >
      </div>
      <div class="flex gap-3">
        <select 
          [(ngModel)]="roleFilter"
          (change)="filterUsers()"
          class="px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-200"
        >
          <option value="">All Roles</option>
          <option value="admin">Admin</option>
          <option value="agent">Agent</option>
          <option value="support">Support</option>
          <option value="patient">Patient</option>
        </select>
        <select 
          [(ngModel)]="statusFilter"
          (change)="filterUsers()"
          class="px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-200"
        >
          <option value="">All Status</option>
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
          <option value="pending">Pending</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Users Table -->
  <div class="bg-white rounded-xl shadow-soft overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-100">
        <thead class="bg-gray-25">
          <tr>
            <th class="px-6 py-4 text-left text-xs font-title font-medium text-gray-600 uppercase tracking-wider">User</th>
            <th class="px-6 py-4 text-left text-xs font-title font-medium text-gray-600 uppercase tracking-wider">Role</th>
            <th class="px-6 py-4 text-left text-xs font-title font-medium text-gray-600 uppercase tracking-wider">Status</th>
            <th class="px-6 py-4 text-left text-xs font-title font-medium text-gray-600 uppercase tracking-wider">Activity</th>
            <th class="px-6 py-4 text-left text-xs font-title font-medium text-gray-600 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-50">
          <tr *ngFor="let user of filteredUsers; let i = index" 
              class="hover:bg-gray-25 transition-all duration-200 stagger-item"
              [style.animation-delay]="(i * 0.1) + 's'">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <img 
                  [src]="user.avatar || 'https://images.pexels.com/photos/91227/pexels-photo-91227.jpeg?auto=compress&cs=tinysrgb&w=150&h=150&dpr=1'" 
                  [alt]="user.name" 
                  class="w-10 h-10 rounded-full object-cover ring-2 ring-gray-100 transition-all duration-200 hover:ring-primary-300"
                >
                <div class="ml-4">
                  <div class="text-sm font-medium text-gray-900">{{ user.name }}</div>
                  <div class="text-sm text-gray-500">{{ user.phone }}</div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium transition-all duration-200"
                    [class]="getRoleStyle(user.role)">
                {{ user.role }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium transition-all duration-200"
                    [class]="getStatusStyle(user.status)">
                {{ user.status }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <div>{{ user.messagesCount }} messages</div>
              <div>{{ user.callsCount }} calls</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <button 
                (click)="viewChat(user.id)"
                class="text-primary-600 hover:text-primary-900 mr-4 btn-hover px-2 py-1 rounded-lg"
              >
                <span class="material-icons text-sm mr-1">chat</span>
                Chat
              </button>
              <button 
                (click)="editUser(user)"
                class="text-indigo-600 hover:text-indigo-900 btn-hover px-2 py-1 rounded-lg"
              >
                <span class="material-icons text-sm mr-1">edit</span>
                Edit
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Add User Modal -->
  <div *ngIf="showAddUserForm" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-soft-lg p-6 w-full max-w-md interactive-hover">
      <div class="flex items-center mb-4">
        <span class="material-icons text-primary-600 mr-3">person_add</span>
        <h2 class="text-xl font-title font-semibold text-gray-900">Add New User</h2>
      </div>
      <form (ngSubmit)="addUser()" #userForm="ngForm">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
          <input 
            type="text" 
            [(ngModel)]="newUser.name" 
            name="name"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500"
          >
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
          <input 
            type="text" 
            [(ngModel)]="newUser.phone" 
            name="phone"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500"
          >
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
          <input 
            type="email" 
            [(ngModel)]="newUser.email" 
            name="email"
            class="w-full px-3 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500"
          >
        </div>
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
          <select 
            [(ngModel)]="newUser.role" 
            name="role"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500"
          >
            <option value="patient">Patient</option>
            <option value="agent">Agent</option>
            <option value="support">Support</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <div class="flex gap-3">
          <button 
            type="submit"
            [disabled]="!userForm.form.valid"
            class="flex-1 bg-gradient-imarlet hover:shadow-imarlet disabled:bg-gray-300 text-white py-2 px-4 rounded-xl font-medium transition-all duration-200 btn-hover"
          >
            Add User
          </button>
          <button 
            type="button"
            (click)="showAddUserForm = false"
            class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-xl font-medium transition-all duration-200 btn-hover"
          >
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>